{"version":3,"sources":["../src/qiniu.js"],"names":["makeRequest","expires","base64ToUrlSafe","v","replace","hmacSha1","encodedFlags","secretKey","hmac","crypto","createHmac","update","digest","url","baseUrl","deadline","Math","floor","Date","now","indexOf","signature","qiniu","SECRET_KEY","encodedSign","downloadToken","ACCESS_KEY","temp"],"mappings":";;;;;;QAegBA,W,GAAAA,W;;AAfhB;;;;AACA;;;;AAEA,IAAMC,UAAU,IAAhB;;AAEA,SAASC,eAAT,CAAyBC,CAAzB,EAA4B;AAC1B,SAAOA,EAAEC,OAAF,CAAU,KAAV,EAAiB,GAAjB,EAAsBA,OAAtB,CAA8B,KAA9B,EAAqC,GAArC,CAAP;AACD;;AAED,SAASC,QAAT,CAAkBC,YAAlB,EAAgCC,SAAhC,EAA2C;AACzC,MAAMC,OAAOC,iBAAOC,UAAP,CAAkB,MAAlB,EAA0BH,SAA1B,CAAb;AACAC,OAAKG,MAAL,CAAYL,YAAZ;AACA,SAAOE,KAAKI,MAAL,CAAY,QAAZ,CAAP;AACD;;AAEM,SAASZ,WAAT,CAAqBa,GAArB,EAA0B;AAC/B,MAAIC,UAAUD,GAAd;AACA,MAAME,WAAWd,UAAUe,KAAKC,KAAL,CAAWC,KAAKC,GAAL,KAAa,IAAxB,CAA3B;;AAEA,MAAIL,QAAQM,OAAR,CAAgB,GAAhB,KAAwB,CAA5B,EAA+B;AAC7BN,eAAW,KAAX;AACD,GAFD,MAEO;AACLA,eAAW,KAAX;AACD;AACDA,aAAWC,QAAX;;AAEA,MAAMM,YAAYhB,SAASS,OAAT,EAAkBQ,cAAMC,UAAxB,CAAlB;AACA,MAAMC,cAActB,gBAAgBmB,SAAhB,CAApB;AACA,MAAMI,gBAAmBH,cAAMI,UAAzB,SAAuCF,WAA7C;;AAEA,SAAUV,OAAV,eAA2BW,aAA3B;AACD;;AAEM,IAAME,sBAAO,IAAb","file":"qiniu.js","sourcesContent":["import crypto from 'crypto'\nimport { qiniu } from './config'\n\nconst expires = 3600\n\nfunction base64ToUrlSafe(v) {\n  return v.replace(/\\//g, '_').replace(/\\+/g, '-')\n}\n\nfunction hmacSha1(encodedFlags, secretKey) {\n  const hmac = crypto.createHmac('sha1', secretKey)\n  hmac.update(encodedFlags)\n  return hmac.digest('base64')\n}\n\nexport function makeRequest(url) {\n  let baseUrl = url\n  const deadline = expires + Math.floor(Date.now() / 1000)\n\n  if (baseUrl.indexOf('?') >= 0) {\n    baseUrl += '&e='\n  } else {\n    baseUrl += '?e='\n  }\n  baseUrl += deadline\n\n  const signature = hmacSha1(baseUrl, qiniu.SECRET_KEY)\n  const encodedSign = base64ToUrlSafe(signature)\n  const downloadToken = `${qiniu.ACCESS_KEY}:${encodedSign}`\n\n  return `${baseUrl}&token=${downloadToken}`\n}\n\nexport const temp = null\n"]}