{"version":3,"sources":["../../src/wechat/getWechatToken.js"],"names":["logger","config","wechatTokenInfo","appId","appSecret","tokenUrl","wechatAccessToken","wechatAccessTokenExpirse","Date","now","request","get","appid","secret","grant_type","response","access_token","error","fetchWechatToken"],"mappings":";;;;;;;;;;;;;;AAAA;;;;AACA;;;;;;IAEQA,M,GAAWC,kB,CAAXD,M;;AACR,IAAME,kBAAkB,EAAxB;;;sFACe;AAAA;AAAA;AAAA;AAAA;AAAA;AACLC,iBADK,GAC0BF,kBAD1B,CACLE,KADK,EACEC,SADF,GAC0BH,kBAD1B,CACEG,SADF,EACaC,QADb,GAC0BJ,kBAD1B,CACaI,QADb;AAELC,6BAFK,GAE2CJ,eAF3C,CAELI,iBAFK,EAEcC,wBAFd,GAE2CL,eAF3C,CAEcK,wBAFd;AAGb;;AAHa,kBAIT,CAACD,iBAAD,IAAsBC,2BAA4B,OAAO,IAAnC,GAA2CC,KAAKC,GAAL,EAJxD;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAKYC,kBAAQC,GAAR,CAAYN,QAAZ,EAAsB;AAC3CO,qBAAOT,KADoC;AAE3CU,sBAAQT,SAFmC;AAG3CU,0BAAY;AAH+B,aAAtB,CALZ;;AAAA;AAKLC,oBALK;;AAUX,gBAAI,CAACA,SAASC,YAAd,EAA4B;AAC1BhB,qBAAOiB,KAAP,CAAa,oCAAb;AACD;AACDf,4BAAgBI,iBAAhB,GAAoCS,SAASC,YAA7C;AACAd,4BAAgBK,wBAAhB,GAA2CC,KAAKC,GAAL,EAA3C;;AAdW;AAAA,6CAgBNP,eAhBM;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;WAAegB,gB;;;;SAAAA,gB","file":"getWechatToken.js","sourcesContent":["import request from '../request'\nimport config from './wxConfig'\n\nconst { logger } = config\nconst wechatTokenInfo = {}\nexport default async function fetchWechatToken() {\n  const { appId, appSecret, tokenUrl } = config\n  const { wechatAccessToken, wechatAccessTokenExpirse } = wechatTokenInfo\n  // ticket的有效期为7200秒 (这里是3600秒时重新获取)\n  if (!wechatAccessToken || wechatAccessTokenExpirse + (3600 * 1000) < Date.now()) {\n    const response = await request.get(tokenUrl, {\n      appid: appId,\n      secret: appSecret,\n      grant_type: 'client_credential',\n    })\n    if (!response.access_token) {\n      logger.error('error when get wechat access_token')\n    }\n    wechatTokenInfo.wechatAccessToken = response.access_token\n    wechatTokenInfo.wechatAccessTokenExpirse = Date.now()\n  }\n  return wechatTokenInfo\n}\n"]}