{"version":3,"sources":["../../src/wechat/getWxTicket.js"],"names":["logger","config","wechatTicketInfo","wxConfig","wechatTicket","wechatAccessTokenExpirse","Date","now","request","get","ticketUrl","access_token","wechatAccessToken","type","response","newWechatTicket","ticket","error","getWechatTicket"],"mappings":";;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;;;IAEQA,M,GAAWC,kB,CAAXD,M;;AACR,IAAIE,mBAAmB,EAAvB;;;sFACe;AAAA;;AAAA;AAAA;AAAA;AAAA;AACLC,oBADK,GACQF,kBADR,CACLE,QADK;AAAA,gCAEsCD,gBAFtC,EAELE,YAFK,qBAELA,YAFK,EAESC,wBAFT,qBAESA,wBAFT;AAGb;;AAHa,kBAIT,CAACD,YAAD,IAAiBC,2BAA4B,OAAO,IAAnC,GAA2CC,KAAKC,GAAL,EAJnD;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAKc,+BALd;;AAAA;AAKXL,4BALW;AAAA;AAAA,mBAMYM,kBAAQC,GAAR,CAAYN,SAASO,SAArB,EAAgC;AACrDC,4BAAcT,iBAAiBU,iBADsB;AAErDC,oBAAM;AAF+C,aAAhC,CANZ;;AAAA;AAMLC,oBANK;AAULC,2BAVK,GAUaD,SAASE,MAVtB;;AAWX,gBAAI,CAACD,eAAL,EAAsBf,OAAOiB,KAAP,CAAa,mBAAb,EAAkCH,QAAlC;AACtBZ,6BAAiBE,YAAjB,GAAgCW,eAAhC;AACAb,6BAAiBG,wBAAjB,GAA4CC,KAAKC,GAAL,EAA5C;;AAbW;AAAA,6CAgBNL,iBAAiBE,YAhBX;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;WAAec,e;;;;SAAAA,e","file":"getWxTicket.js","sourcesContent":["import request from '../request'\nimport getWechatToken from './getWechatToken'\nimport config from './wxConfig'\n\nconst { logger } = config\nlet wechatTicketInfo = {}\nexport default async function getWechatTicket() {\n  const { wxConfig } = config\n  const { wechatTicket, wechatAccessTokenExpirse } = wechatTicketInfo\n  // ticket的有效期为7200秒 (这里是3600秒时重新获取)\n  if (!wechatTicket || wechatAccessTokenExpirse + (3600 * 1000) < Date.now()) {\n    wechatTicketInfo = await getWechatToken()\n    const response = await request.get(wxConfig.ticketUrl, {\n      access_token: wechatTicketInfo.wechatAccessToken,\n      type: 'jsapi',\n    })\n    const newWechatTicket = response.ticket\n    if (!newWechatTicket) logger.error('获取wechat ticket失败', response)\n    wechatTicketInfo.wechatTicket = newWechatTicket\n    wechatTicketInfo.wechatAccessTokenExpirse = Date.now()\n  }\n\n  return wechatTicketInfo.wechatTicket\n}\n"]}