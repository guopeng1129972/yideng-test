{"version":3,"sources":["../../src/wechat/getWxSdkConfig.js"],"names":["logger","config","req","res","next","wxConfig","fullPath","query","currentUrl","domain","wechatTicket","timestamp","Math","floor","Date","now","nonceStr","random","toString","substr","string1","signature","CryptoJS","SHA1","wxSdkConfig","appId","json","apiList","error","stack"],"mappings":";;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;;;IAEQA,M,GAAWC,kB,CAAXD,M;;;sFACO,iBAAOE,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAA4B;AACjCC,oBADK,GACQJ,kBADR,CACLI,QADK;AAAA;AAGHC,oBAHG,GAGUJ,IAAIK,KAHd,CAGHD,QAHG;AAILE,sBAJK,QAIWH,SAASI,MAJpB,GAI6BH,QAJ7B;AAAA;AAAA,mBAKgB,4BALhB;;AAAA;AAKLI,wBALK;AAMLC,qBANK,GAMOC,KAAKC,KAAL,CAAWC,KAAKC,GAAL,KAAa,IAAxB,CANP;AAOLC,oBAPK,GAOMJ,KAAKK,MAAL,GAAcC,QAAd,CAAuB,EAAvB,EAA2BC,MAA3B,CAAkC,CAAlC,EAAqC,EAArC,CAPN;AAQLC,mBARK,qBAQqBV,YARrB,kBAQ8CM,QAR9C,mBAQoEL,SARpE,aAQqFH,UARrF;AASLa,qBATK,GASOC,mBAASC,IAAT,CAAcH,OAAd,EAAuBF,QAAvB,EATP,EAS0C;;AAC/CM,uBAVK,GAUS,EAAEH,oBAAF,EAAaL,kBAAb,EAAuBL,oBAAvB,EAVT;;AAWXa,wBAAYC,KAAZ,GAAoBpB,SAASoB,KAA7B;AAXW,6CAYJtB,IAAIuB,IAAJ,CAAS,EAAEF,wBAAF,EAAeG,SAAS1B,mBAAO0B,OAA/B,EAAT,CAZI;;AAAA;AAAA;AAAA;;AAcX3B,mBAAO4B,KAAP,CAAa,4BAAb,EAA2C,YAAEC,KAA7C;;AAdW;AAgBbzB;;AAhBa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G","file":"getWxSdkConfig.js","sourcesContent":["import CryptoJS from 'crypto-js'\nimport fetchWxTicket from './getWxTicket'\nimport config from './wxConfig'\n\nconst { logger } = config\nexport default async (req, res, next) => { // eslint-disable-line\n  const { wxConfig } = config\n  try {\n    const { fullPath } = req.query\n    const currentUrl = `${wxConfig.domain}${fullPath}`\n    const wechatTicket = await fetchWxTicket()\n    const timestamp = Math.floor(Date.now() / 1000)\n    const nonceStr = Math.random().toString(32).substr(2, 15)\n    const string1 = `jsapi_ticket=${wechatTicket}&noncestr=${nonceStr}&timestamp=${timestamp}&url=${currentUrl}`\n    const signature = CryptoJS.SHA1(string1).toString()  // eslint-disable-line\n    const wxSdkConfig = { signature, nonceStr, timestamp }\n    wxSdkConfig.appId = wxConfig.appId\n    return res.json({ wxSdkConfig, apiList: config.apiList })\n  } catch (e) {\n    logger.error('error when getWxSdkConfig:', e.stack)\n  }\n  next()\n}\n"]}