import mongoose from 'mongoose'
import config from './config'

const logger = global.logger || console.log
logger.info(`mongodb ConnectionString is:=====> ${config.mongodb}`)

mongoose.connect(
  config.mongodb,
  {
    useMongoClient: true,
    autoReconnect: true,
    poolSize: 10,
    keepAlive: 1,
    connectTimeoutMS: 30000,
    reconnectTries: Number.MAX_VALUE,
    reconnectInterval: 2000,
  },
  err => {
    if (err) logger.error(`mongodb error ${err}`)
  }
)

mongoose.Promise = require('bluebird')

exports.mongoose = mongoose
