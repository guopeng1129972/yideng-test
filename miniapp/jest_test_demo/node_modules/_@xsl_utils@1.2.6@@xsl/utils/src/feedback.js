import request from './request'
import {
  drDomain,
  feedBack,
} from './config'

const defaultAppNames = ['medchart', 'medclips_plus']

/**
 * 发送纯文本小秘书消息，
 * @param {String} doctorId 医生id
 * @param {String} message 文本消息内容
 * @param {String|Array<string>} appName 发送App名称，默认全发（经典版，新版病历夹）
 */
// eslint-disable-next-line import/prefer-default-export
export const sendFeedbackTextMessage = async ({
  doctorId,
  message,
  appName = defaultAppNames,
}) => {
  const appNames = Array.isArray(appName) ? appName : [appName]
  const results = await Promise.all(appNames.map(_appName => (
    request
      .post(`${drDomain}/api/feedback/BusinessMessage`, {
        adminId: feedBack.adminId,
        message,
        messageType: 'TEXT',
        type: 2,
        toId: doctorId,
        appName: _appName,
        createdAt: new Date(),
      })
  )))

  console.info(`[Send Feedback Text Message]:
{ ${doctorId}, ${message} }, feedback response: , ${JSON.stringify(results)}`)
  return results
}
